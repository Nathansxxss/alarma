<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reloj con Alarma</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0c10;
      --panel: #0f1318;
      --border: #1e2530;
      --green: #00ff9d;
      --green-dim: #00ff9d33;
      --green-mid: #00ff9d88;
      --red: #ff3b5c;
      --red-dim: #ff3b5c33;
      --amber: #ffb800;
      --text: #c8d8e8;
      --muted: #4a5a6a;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Rajdhani', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* Grid background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--border) 1px, transparent 1px),
        linear-gradient(90deg, var(--border) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.4;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 1;
      width: 520px;
      padding: 0 20px;
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 30px;
    }

    .dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 8px var(--green);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .header-title {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 4px;
      color: var(--muted);
      text-transform: uppercase;
    }

    /* Clock Panel */
    .clock-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 40px 30px 30px;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .clock-panel::before {
      content: 'SYS.CLOCK';
      position: absolute;
      top: -1px; left: 20px;
      background: var(--panel);
      padding: 0 8px;
      font-size: 9px;
      letter-spacing: 3px;
      color: var(--muted);
      font-family: 'Share Tech Mono', monospace;
    }

    /* Alarm state */
    .clock-panel.alarm-active {
      border-color: var(--red);
      box-shadow: 0 0 40px var(--red-dim), inset 0 0 60px var(--red-dim);
      animation: alarm-flash 0.5s ease-in-out infinite;
    }

    @keyframes alarm-flash {
      0%, 100% { box-shadow: 0 0 40px var(--red-dim), inset 0 0 60px var(--red-dim); }
      50% { box-shadow: 0 0 80px #ff3b5c88, inset 0 0 80px #ff3b5c44; }
    }

    /* Countdown state */
    .clock-panel.countdown-running {
      border-color: var(--amber);
      box-shadow: 0 0 20px #ffb80022;
    }

    /* Clock display */
    .time-display {
      font-family: 'Share Tech Mono', monospace;
      font-size: 72px;
      letter-spacing: -2px;
      color: var(--green);
      text-shadow: 0 0 20px var(--green-mid);
      text-align: center;
      line-height: 1;
      margin-bottom: 6px;
      transition: color 0.3s, text-shadow 0.3s;
    }

    .clock-panel.alarm-active .time-display {
      color: var(--red);
      text-shadow: 0 0 30px var(--red);
    }

    .date-display {
      font-size: 13px;
      letter-spacing: 3px;
      color: var(--muted);
      text-align: center;
      text-transform: uppercase;
      margin-bottom: 30px;
    }

    /* Separator */
    .sep {
      height: 1px;
      background: var(--border);
      margin: 0 0 24px;
    }

    /* Countdown display */
    .countdown-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .countdown-label {
      font-size: 10px;
      letter-spacing: 3px;
      color: var(--muted);
      text-transform: uppercase;
    }

    .countdown-value {
      font-family: 'Share Tech Mono', monospace;
      font-size: 28px;
      color: var(--amber);
      text-shadow: 0 0 12px #ffb80066;
      letter-spacing: 2px;
      transition: color 0.3s;
    }

    .countdown-value.idle {
      color: var(--muted);
      text-shadow: none;
      font-size: 20px;
    }

    .clock-panel.alarm-active .countdown-value {
      color: var(--red);
      text-shadow: 0 0 12px var(--red);
    }

    /* Status badge */
    .status-badge {
      font-size: 10px;
      letter-spacing: 2px;
      padding: 3px 10px;
      border-radius: 2px;
      text-transform: uppercase;
      font-weight: 700;
    }

    .status-badge.idle { background: var(--border); color: var(--muted); }
    .status-badge.running { background: #ffb80022; color: var(--amber); border: 1px solid #ffb80044; }
    .status-badge.alarming { background: var(--red-dim); color: var(--red); border: 1px solid var(--red); animation: badge-flash 0.5s infinite; }

    @keyframes badge-flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* Input row */
    .input-row {
      display: flex;
      gap: 10px;
      align-items: stretch;
    }

    .input-wrap {
      flex: 1;
      position: relative;
    }

    .input-wrap label {
      position: absolute;
      top: -8px; left: 10px;
      background: var(--panel);
      padding: 0 5px;
      font-size: 9px;
      letter-spacing: 2px;
      color: var(--muted);
      text-transform: uppercase;
    }

    input[type="number"] {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 12px 14px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 18px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    input[type="number"]:focus { border-color: var(--green); }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }

    /* Buttons */
    .btn {
      padding: 12px 20px;
      border: 1px solid;
      border-radius: 3px;
      font-family: 'Rajdhani', sans-serif;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .btn-set {
      border-color: var(--green);
      color: var(--green);
      background: transparent;
    }

    .btn-set:hover {
      background: var(--green-dim);
      box-shadow: 0 0 15px var(--green-dim);
    }

    .btn-stop {
      border-color: var(--red);
      color: var(--red);
      background: transparent;
      display: none;
    }

    .btn-stop.visible { display: block; }

    .btn-stop:hover {
      background: var(--red-dim);
      box-shadow: 0 0 15px var(--red-dim);
    }

    /* Alarm message */
    .alarm-msg {
      display: none;
      text-align: center;
      margin-top: 20px;
      font-size: 13px;
      letter-spacing: 4px;
      color: var(--red);
      text-transform: uppercase;
      animation: msg-fade 0.5s infinite alternate;
    }

    @keyframes msg-fade {
      from { opacity: 1; }
      to { opacity: 0.3; }
    }

    .alarm-msg.visible { display: block; }

    /* Scanline overlay */
    .clock-panel::after {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        0deg, transparent, transparent 2px, rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.04) 4px
      );
      pointer-events: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="dot" id="statusDot"></div>
    <span class="header-title">Terminal Clock v1.0</span>
  </div>

  <div class="clock-panel" id="clockPanel">
    <div class="time-display" id="timeDisplay">00:00:00</div>
    <div class="date-display" id="dateDisplay">—</div>

    <div class="sep"></div>

    <div class="countdown-section">
      <div>
        <div class="countdown-label">Tiempo restante</div>
        <div class="countdown-value idle" id="countdownDisplay">-- --</div>
      </div>
      <span class="status-badge idle" id="statusBadge">Inactivo</span>
    </div>

    <div class="input-row">
      <div class="input-wrap">
        <label>Alarma (segundos)</label>
        <input type="number" id="alarmInput" placeholder="e.g. 60" min="1">
      </div>
      <button class="btn btn-set" id="btnSet" onclick="setAlarm()">Activar</button>
      <button class="btn btn-stop" id="btnStop" onclick="stopAlarm()">Detener</button>
    </div>

    <div class="alarm-msg" id="alarmMsg">⚠ ALARMA ACTIVADA ⚠</div>
  </div>
</div>

<script>
  // ── Variables de estado ──────────────────────────────────────────
  let clockInterval = null;   // setInterval para el reloj
  let alarmTimeout  = null;   // setTimeout para la alarma
  let countdownInterval = null; // setInterval para el contador regresivo
  let secondsLeft   = 0;
  let alarmActive   = false;
  let audioCtx      = null;

  // ── Elementos DOM ────────────────────────────────────────────────
  const panel       = document.getElementById('clockPanel');
  const timeDisplay = document.getElementById('timeDisplay');
  const dateDisplay = document.getElementById('dateDisplay');
  const countdownEl = document.getElementById('countdownDisplay');
  const statusBadge = document.getElementById('statusBadge');
  const statusDot   = document.getElementById('statusDot');
  const alarmMsg    = document.getElementById('alarmMsg');
  const btnSet      = document.getElementById('btnSet');
  const btnStop     = document.getElementById('btnStop');
  const alarmInput  = document.getElementById('alarmInput');

  // ── Funciones de reloj ───────────────────────────────────────────
  function formatTwo(n) {
    return String(n).padStart(2, '0');
  }

  function updateClock() {
    const now = new Date();
    const h = formatTwo(now.getHours());
    const m = formatTwo(now.getMinutes());
    const s = formatTwo(now.getSeconds());
    timeDisplay.textContent = `${h}:${m}:${s}`;

    const days = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
    const months = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
    const d = now.getDate();
    dateDisplay.textContent = `${days[now.getDay()]}  ${formatTwo(d)} ${months[now.getMonth()]} ${now.getFullYear()}`;
  }

  function startClock() {
    updateClock();
    clockInterval = setInterval(updateClock, 1000);
  }

  // ── Cuenta regresiva ─────────────────────────────────────────────
  function formatCountdown(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${formatTwo(m)}:${formatTwo(s)}`;
  }

  function startCountdown(seconds) {
    secondsLeft = seconds;
    countdownEl.classList.remove('idle');
    countdownEl.textContent = formatCountdown(secondsLeft);

    countdownInterval = setInterval(function() {
      secondsLeft--;
      countdownEl.textContent = formatCountdown(Math.max(secondsLeft, 0));
      if (secondsLeft <= 0) {
        clearInterval(countdownInterval);
      }
    }, 1000);
  }

  function stopCountdown() {
    clearInterval(countdownInterval);
    countdownEl.textContent = '-- --';
    countdownEl.classList.add('idle');
  }

  // ── Alarma ───────────────────────────────────────────────────────
  function setAlarm() {
    const seconds = parseInt(alarmInput.value, 10);

    if (!seconds || seconds < 1) {
      alarmInput.focus();
      alarmInput.style.borderColor = 'var(--red)';
      setTimeout(() => alarmInput.style.borderColor = '', 800);
      return;
    }

    // Limpiar alarma previa si había
    if (alarmTimeout) clearTimeout(alarmTimeout);
    stopCountdown();
    resetVisuals();

    // Actualizar UI a estado "corriendo"
    setStatus('running');
    startCountdown(seconds);

    // Programar alarma con setTimeout
    alarmTimeout = setTimeout(triggerAlarm, seconds * 1000);

    btnSet.textContent = 'Reiniciar';
    btnStop.classList.add('visible');
  }

  function triggerAlarm() {
    alarmActive = true;
    stopCountdown();
    setStatus('alarming');
    playAlarmSound();
    countdownEl.textContent = '00:00';
    countdownEl.classList.remove('idle');
  }

  function stopAlarm() {
    // Detener todo
    if (alarmTimeout) { clearTimeout(alarmTimeout); alarmTimeout = null; }
    stopCountdown();
    stopAlarmSound();
    alarmActive = false;
    resetVisuals();
    setStatus('idle');
    btnStop.classList.remove('visible');
    btnSet.textContent = 'Activar';
    alarmInput.value = '';
  }

  function resetVisuals() {
    panel.classList.remove('alarm-active', 'countdown-running');
    alarmMsg.classList.remove('visible');
    statusDot.style.background = 'var(--green)';
    statusDot.style.boxShadow = '0 0 8px var(--green)';
  }

  function setStatus(state) {
    statusBadge.className = 'status-badge';
    if (state === 'idle') {
      statusBadge.classList.add('idle');
      statusBadge.textContent = 'Inactivo';
      panel.classList.remove('alarm-active', 'countdown-running');
      alarmMsg.classList.remove('visible');
    } else if (state === 'running') {
      statusBadge.classList.add('running');
      statusBadge.textContent = 'En curso';
      panel.classList.add('countdown-running');
      panel.classList.remove('alarm-active');
      statusDot.style.background = 'var(--amber)';
      statusDot.style.boxShadow = '0 0 8px var(--amber)';
    } else if (state === 'alarming') {
      statusBadge.classList.add('alarming');
      statusBadge.textContent = '¡ALARMA!';
      panel.classList.remove('countdown-running');
      panel.classList.add('alarm-active');
      alarmMsg.classList.add('visible');
      statusDot.style.background = 'var(--red)';
      statusDot.style.boxShadow = '0 0 8px var(--red)';
    }
  }

  // ── Sonido de alarma (Web Audio API) ─────────────────────────────
  let alarmSoundInterval = null;

  function playBeepSequence() {
    if (!audioCtx) return;
    const beepTimes = [0, 0.3, 0.6, 1.0, 1.3, 1.6];
    beepTimes.forEach(function(t) {
      const osc  = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.type = 'square';
      osc.frequency.setValueAtTime(880, audioCtx.currentTime + t);
      osc.frequency.setValueAtTime(660, audioCtx.currentTime + t + 0.1);
      gain.gain.setValueAtTime(0.15, audioCtx.currentTime + t);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + t + 0.25);
      osc.start(audioCtx.currentTime + t);
      osc.stop(audioCtx.currentTime + t + 0.25);
    });
  }

  function playAlarmSound() {
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } catch (e) { return; }

    // Reproducir inmediatamente y luego repetir cada 2.5s hasta que se detenga
    playBeepSequence();
    alarmSoundInterval = setInterval(playBeepSequence, 2500);
  }

  function stopAlarmSound() {
    if (alarmSoundInterval) {
      clearInterval(alarmSoundInterval);
      alarmSoundInterval = null;
    }
    if (audioCtx) {
      audioCtx.close();
      audioCtx = null;
    }
  }

  // ── Tecla Enter activa la alarma ─────────────────────────────────
  alarmInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') setAlarm();
  });

  // ── Iniciar ──────────────────────────────────────────────────────
  startClock();
</script>
</body>
</html>
